name: Github workflow test
on:
  pull_request:
  push:
jobs:
  unit-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@main
      - uses: actions/setup-go@main
        with:
          go-version: 1.16
      - run: make basic-checks
        name: run basic checks like linter
      - run: make tape
        name: build tape binary program
      - run: make escapes
        name: run escapes check for tape
      - run: make install
        name: install tape to GOBIN
      - run: make unit-test
        name: run unit test
  docker-build-test:
    runs-on: ubuntu-latest
    needs: unit-test
    steps:
      - uses: actions/checkout@main
      - run: make docker
        name: build tape docker
  integration-test-1412:
    runs-on: ubuntu-latest
    needs: unit-test
    strategy:
      matrix:
        FABRIC_VERSION: [1_4]
        INTERGATION_CASE: [ANDLogic]
    steps:
      - uses: actions/checkout@main
      - uses: actions/setup-go@main
        with:
          go-version: 1.16
      - run: go mod vendor
      - run: make integration-test FABRIC_VERSION=${{matrix.FABRIC_VERSION}} INTERGATION_CASE=${{matrix.INTERGATION_CASE}}
  integration-test:
    runs-on: ubuntu-latest
    needs: unit-test
    strategy:
      matrix:
        FABRIC_VERSION: [2_2, latest]
        INTERGATION_CASE: [ORLogic, ANDLogic, COMMITONLY, ENDORSEMNTONLY]
    steps:
      - uses: actions/checkout@main
      - uses: actions/setup-go@main
        with:
          go-version: 1.16
      - run: go mod vendor
      - run: make integration-test FABRIC_VERSION=${{matrix.FABRIC_VERSION}} INTERGATION_CASE=${{matrix.INTERGATION_CASE}}